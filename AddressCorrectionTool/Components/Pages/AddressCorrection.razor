@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms
@using System.Text.Json
@using AddressCorrectionTool.Models
@using System.Text
@using Microsoft.AspNetCore.Authorization
@using System.Net.Http
@using Microsoft.AspNetCore.Components.Web

@rendermode InteractiveServer

@attribute [Authorize]

@page "/address-correction"

<h3>AddressCorrection</h3>

<h3>Upload known-good addresses</h3>

<p>Upload a CSV file containing known-good addresses.</p>

<EditForm Model="@addressToBeCorrected" FormName="addressForm" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />

    <div class="form-group col-md-4">
        <label for="Number">Number</label>
        <InputText id="Number" class="form-control" @bind-Value="@addressToBeCorrected.Number" />
    </div>

    <div class="form-group col-md-4">
        <label for="Street">Street</label>
        <InputText id="Street" class="form-control" @bind-Value="@addressToBeCorrected.Street" />
    </div>

    <div class="form-group col-md-4">
        <label for="Unit">Unit</label>
        <InputText id="Unit" class="form-control" @bind-Value="@addressToBeCorrected.Unit" />
    </div>

    <div class="form-group col-md-4">
        <label for="City">City</label>
        <InputText id="City" class="form-control" @bind-Value="@addressToBeCorrected.City" />
    </div>

    <div class="form-group col-md-4">
        <label for="Postcode">Postcode</label>
        <InputText id="Postcode" class="form-control" @bind-Value="@addressToBeCorrected.Postcode" />
    </div>

    <div class="form-group col-md-4">
        <label for="Region">Region</label>
        <InputText id="Region" class="form-control" @bind-Value="@addressToBeCorrected.Region" />
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@code {
    private Models.InputAddress addressToBeCorrected = new Models.InputAddress();

    private async Task HandleValidSubmit()
    {

        Console.WriteLine(addressToBeCorrected.Number);

        // convert the InputAddress object to a JSON string
        string json = JsonSerializer.Serialize(addressToBeCorrected);

        Console.WriteLine(json);

        await Task.Delay(1000);
        // send the JSON string to the server
    }
}